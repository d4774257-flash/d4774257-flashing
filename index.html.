<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT DevTool: Professional Management Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/index.umd.min.js"></script>
    <style>
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); }
        .pending-anim { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .4; } }
        .sim-border { border: 2px solid #3b82f6 !important; }
        .error-border { border: 2px solid #ef4444 !important; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen font-sans selection:bg-emerald-500/30">

<div class="container mx-auto px-4 py-8 max-w-5xl">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8 bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
        <div class="flex items-center gap-2">
            <div id="statusDot" class="w-3 h-3 rounded-full bg-emerald-500 shadow-[0_0_10px_#10b981]"></div>
            <span id="envLabel" class="text-xs font-bold uppercase tracking-widest text-emerald-500">Live Sepolia Network</span>
        </div>
        
        <div class="flex bg-slate-800 p-1 rounded-xl border border-slate-700">
            <button id="liveBtn" onclick="setEnv('live')" class="px-6 py-2 rounded-lg text-xs font-bold transition-all bg-emerald-600 text-white">LIVE MODE</button>
            <button id="simBtn" onclick="setEnv('sim')" class="px-6 py-2 rounded-lg text-xs font-bold transition-all text-slate-400 hover:text-white">SIMULATION</button>
        </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-8">
        <aside class="space-y-6">
            <div class="p-6 glass rounded-3xl border border-slate-800 shadow-2xl">
                <p class="text-[10px] uppercase font-black text-slate-500 mb-1 tracking-tighter">Current Wallet</p>
                <p id="addrDisp" class="text-xs font-mono break-all text-emerald-400">Connecting...</p>
                <div class="mt-6">
                    <p class="text-[10px] uppercase font-black text-slate-500 tracking-tighter">Balance</p>
                    <div class="flex items-baseline gap-2">
                        <span id="balDisp" class="text-4xl font-light">0.00</span>
                        <span class="text-emerald-500 font-bold">USDT</span>
                    </div>
                </div>
            </div>

            <div id="errorPanel" class="hidden p-6 bg-red-950/20 rounded-3xl border border-red-900/50">
                <h3 class="text-sm font-bold text-red-400 mb-3">Debug: Inject Errors</h3>
                <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" id="failNext" class="w-4 h-4 rounded border-red-500 text-red-600 bg-slate-900">
                    <span class="text-xs text-slate-400">Fail next transaction (RPC Error)</span>
                </label>
            </div>
        </aside>

        <main class="lg:col-span-2 space-y-8">
            <section class="p-8 glass rounded-3xl border border-slate-800 relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-xl font-bold mb-6">Initiate Transfer</h2>
                    <div class="grid gap-4">
                        <input id="target" type="text" placeholder="Recipient Address (0x...)" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-mono">
                        <input id="amt" type="number" placeholder="0.00 USDT" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-mono">
                        <button id="execBtn" onclick="runTx()" class="w-full bg-emerald-600 hover:bg-emerald-500 py-4 rounded-xl font-black text-white transition-all transform active:scale-[0.98] shadow-lg shadow-emerald-900/20">
                            BROADCAST TO NETWORK
                        </button>
                    </div>
                </div>
            </section>

            <section class="p-8 glass rounded-3xl border border-slate-800">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Transaction Ledger</h2>
                    <button onclick="clearHistory()" class="text-[10px] text-slate-500 hover:text-red-400 font-bold uppercase tracking-widest">Clear Cache</button>
                </div>
                <div id="txFeed" class="space-y-3">
                    </div>
            </section>
        </main>
    </div>
</div>

<script>
    const USDT_CONTRACT = "0x7169D38820dfd117C3FA1f22a697dBA58d90BA06";
    const ABI = ["function balanceOf(address o) view returns (uint256)", "function transfer(address t, uint256 a) returns (bool)", "function decimals() view returns (uint8)"];
    
    let env = 'live'; 
    let walletBal = 2500.50;
    let txs = JSON.parse(localStorage.getItem('usdt_log')) || [];

    async function setEnv(m) {
        env = m;
        const isSim = env === 'sim';
        document.getElementById('liveBtn').className = `px-6 py-2 rounded-lg text-xs font-bold transition-all ${!isSim ? 'bg-emerald-600 text-white' : 'text-slate-400'}`;
        document.getElementById('simBtn').className = `px-6 py-2 rounded-lg text-xs font-bold transition-all ${isSim ? 'bg-blue-600 text-white' : 'text-slate-400'}`;
        document.getElementById('envLabel').innerText = isSim ? "Simulation Environment" : "Live Sepolia Network";
        document.getElementById('envLabel').className = `text-xs font-bold uppercase tracking-widest ${isSim ? 'text-blue-500' : 'text-emerald-500'}`;
        document.getElementById('statusDot').className = `w-3 h-3 rounded-full ${isSim ? 'bg-blue-500' : 'bg-emerald-500'}`;
        document.getElementById('errorPanel').classList.toggle('hidden', !isSim);
        
        isSim ? setupSim() : setupLive();
        renderLog();
    }

    function setupSim() {
        document.getElementById('addrDisp').innerText = "0xSIMULATED_DEVELOPER_NODE_8892";
        updateDisplay(walletBal);
    }

    async function setupLive() {
        if (!window.ethereum) return (document.getElementById('addrDisp').innerText = "MetaMask Not Found");
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById('addrDisp').innerText = address;
        
        const contract = new ethers.Contract(USDT_CONTRACT, ABI, signer);
        const b = await contract.balanceOf(address);
        const d = await contract.decimals();
        updateDisplay(ethers.formatUnits(b, d));
    }

    async function runTx() {
        const to = document.getElementById('target').value;
        const val = document.getElementById('amt').value;
        if (!val || val <= 0) return alert("Enter valid amount");

        if (env === 'sim') {
            const fail = document.getElementById('failNext').checked;
            const h = "0x" + Math.random().toString(16).slice(2, 66);
            
            if (fail) {
                alert("Simulated Error: RPC Node Timeout (504)");
                addLog(h, val, 'Failed');
                return;
            }

            addLog(h, val, 'Pending');
            setTimeout(() => {
                confirmLog(h);
                walletBal -= parseFloat(val);
                updateDisplay(walletBal);
            }, 7000);
        } else {
            // Live MetaMask Logic
            alert("Confirm in MetaMask...");
            // ... (Ethers.js live transfer call would go here)
        }
    }

    function addLog(h, a, s) {
        txs.unshift({ h, a, s, t: new Date().toLocaleTimeString() });
        save();
    }

    function confirmLog(h) {
        const i = txs.findIndex(x => x.h === h);
        if (i > -1) txs[i].s = 'Confirmed';
        save();
    }

    function updateDisplay(v) { document.getElementById('balDisp').innerText = parseFloat(v).toLocaleString(); }
    function save() { localStorage.setItem('usdt_log', JSON.stringify(txs.slice(0, 15))); renderLog(); }
    function clearHistory() { txs = []; save(); }

    function renderLog() {
        const f = document.getElementById('txFeed');
        f.innerHTML = txs.length ? "" : '<p class="text-center text-slate-600 py-8 italic text-xs">Waiting for blockchain activity...</p>';
        txs.forEach(x => {
            const d = document.createElement('div');
            d.className = `p-4 rounded-2xl bg-slate-900 border border-slate-800 flex justify-between items-center ${x.s === 'Pending' ? 'pending-anim' : ''}`;
            d.innerHTML = `<div><p class="text-[10px] font-mono text-slate-500">${x.h.slice(0,20)}...</p><p class="font-bold">-${x.a} USDT</p></div>
            <span class="text-[10px] font-black px-3 py-1 rounded-full ${x.s==='Pending'?'bg-amber-500/10 text-amber-500':x.s==='Failed'?'bg-red-500/10 text-red-500':'bg-emerald-500/10 text-emerald-500'}">${x.s.toUpperCase()}</span>`;
            f.appendChild(d);
        });
    }

    window.onload = () => setEnv('live');
</script>
</body>
</html>
